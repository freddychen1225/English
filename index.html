<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Speak è‹±èªæ•™ç·´</title>
    <style>
        :root {
            --primary: #54a0ff;
            --user-bg: #c8d6e5;
            --ai-bg: #feca57;
            --bg: #222f3e;
            --text: #c8d6e5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { margin-bottom: 5px; color: var(--primary); }
        .subtitle { font-size: 0.9rem; color: #8395a7; margin-bottom: 20px; }

        /* é¸å–®é é¢ */
        #menu-page { width: 100%; max-width: 600px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .scenario-btn {
            background: #341f97; color: white; border: none;
            padding: 20px; border-radius: 15px; font-size: 1rem;
            cursor: pointer; display: flex; flex-direction: column; align-items: center;
            transition: 0.2s;
        }
        .scenario-btn:active { transform: scale(0.95); }
        .emoji { font-size: 2rem; margin-bottom: 5px; }

        /* ç·´ç¿’é é¢ */
        #practice-page { display: none; width: 100%; max-width: 500px; flex-direction: column; align-items: center; }
        
        .chat-box {
            width: 100%; background: rgba(255,255,255,0.1);
            border-radius: 20px; padding: 20px; margin-bottom: 20px;
            min-height: 200px; display: flex; flex-direction: column; justify-content: center;
        }

        .role-label { font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: #8395a7; }
        .text-content { font-size: 1.4rem; font-weight: bold; line-height: 1.4; margin-bottom: 10px; }
        .translation { font-size: 1rem; color: #ff9ff3; margin-bottom: 10px; }
        
        .ai-text { color: var(--ai-bg); }
        .user-text { color: var(--primary); }

        /* æ§åˆ¶å€ */
        .controls { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        
        .action-btn {
            width: 80px; height: 80px; border-radius: 50%; border: none;
            font-size: 2rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: 0.2s;
        }
        .play-btn { background: var(--ai-bg); color: #222; }
        .mic-btn { background: var(--primary); color: white; }
        .mic-btn.listening { background: #ff6b6b; animation: pulse 1s infinite; }
        
        .next-btn {
            background: transparent; border: 2px solid #8395a7; color: #8395a7;
            padding: 10px 30px; border-radius: 30px; cursor: pointer; font-weight: bold;
        }

        .result-area {
            margin-top: 10px; padding: 10px; width: 100%; text-align: center;
            background: rgba(0,0,0,0.2); border-radius: 10px; min-height: 50px;
            color: #1dd1a1; font-size: 1.1rem;
        }

        .back-btn { position: absolute; top: 20px; left: 20px; background: none; border: none; color: #8395a7; font-size: 1.5rem; cursor: pointer; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <div id="menu-page">
        <h1>Echo Speak ğŸ‡ºğŸ‡¸</h1>
        <div class="subtitle">ç”Ÿæ´»æƒ…å¢ƒå£èªªæ•™ç·´</div>
        <div class="grid" id="scenario-grid"></div>
    </div>

    <div id="practice-page">
        <button class="back-btn" onclick="goHome()">â¬…ï¸</button>
        <h2 id="scenario-title" style="margin-top: 0;"></h2>
        
        <div class="chat-box">
            <div class="role-label" id="role-label">AI Teacher</div>
            <div class="text-content" id="display-text">...</div>
            <div class="translation" id="translation-text">...</div>
        </div>

        <div class="controls">
            <!-- AI æ’­æ”¾æŒ‰éˆ• -->
            <button class="action-btn play-btn" id="play-btn" onclick="speakText()">ğŸ”Š</button>
            
            <!-- ç”¨æˆ¶éŒ„éŸ³æŒ‰éˆ• -->
            <button class="action-btn mic-btn" id="mic-btn" onclick="toggleMic()" style="display:none;">ğŸ¤</button>
            
            <!-- è¾¨è­˜çµæœ -->
            <div class="result-area" id="result-text">...</div>

            <button class="next-btn" onclick="nextLine()">Next Line â¡ï¸</button>
        </div>
    </div>

    <script>
        // --- 10å¤§æƒ…å¢ƒåŠ‡æœ¬è³‡æ–™åº« ---
        const scenarios = [
            {
                title: "Coffee Shop", emoji: "â˜•",
                dialogs: [
                    { role: "AI", text: "Hi, are you ready to order?", trans: "å—¨ï¼Œæº–å‚™å¥½é»é¤äº†å—ï¼Ÿ" },
                    { role: "User", text: "Yes, I would like a hot latte, please.", trans: "æ˜¯çš„ï¼Œæˆ‘æƒ³è¦ä¸€æ¯ç†±æ‹¿éµã€‚" },
                    { role: "AI", text: "Sure. What size would you like?", trans: "æ²’å•é¡Œï¼Œæƒ³è¦ä»€éº¼å°ºå¯¸ï¼Ÿ" },
                    { role: "User", text: "Medium size, please.", trans: "ä¸­æ¯ï¼Œè¬è¬ã€‚" },
                    { role: "AI", text: "Anything else to eat?", trans: "é‚„è¦åƒé»ä»€éº¼å—ï¼Ÿ" },
                    { role: "User", text: "No, that's all. Thank you.", trans: "ä¸ç”¨ï¼Œé€™æ¨£å°±å¥½ã€‚è¬è¬ã€‚" }
                ]
            },
            {
                title: "Restaurant", emoji: "ğŸ”",
                dialogs: [
                    { role: "AI", text: "Welcome! Do you have a reservation?", trans: "æ­¡è¿å…‰è‡¨ï¼è«‹å•æœ‰è¨‚ä½å—ï¼Ÿ" },
                    { role: "User", text: "No, I don't. Do you have a table for two?", trans: "æ²’æœ‰ã€‚è«‹å•æœ‰å…©äººçš„ä½å­å—ï¼Ÿ" },
                    { role: "AI", text: "Yes, right this way. Here is the menu.", trans: "æœ‰çš„ï¼Œé€™é‚Šè«‹ã€‚é€™æ˜¯èœå–®ã€‚" },
                    { role: "User", text: "Can we have some water, please?", trans: "è«‹çµ¦æˆ‘å€‘ä¸€é»æ°´å¥½å—ï¼Ÿ" }
                ]
            },
            {
                title: "Airport Check-in", emoji: "âœˆï¸",
                dialogs: [
                    { role: "AI", text: "Passport please. Where are you flying to?", trans: "è«‹å‡ºç¤ºè­·ç…§ã€‚ä½ è¦é£›å¾€å“ªè£¡ï¼Ÿ" },
                    { role: "User", text: "I am flying to Tokyo.", trans: "æˆ‘è¦é£›å¾€æ±äº¬ã€‚" },
                    { role: "AI", text: "Do you have any bags to check?", trans: "æœ‰è¡Œæè¦è¨—é‹å—ï¼Ÿ" },
                    { role: "User", text: "Yes, just one suitcase.", trans: "æœ‰ï¼Œåªæœ‰ä¸€å€‹è¡Œæç®±ã€‚" }
                ]
            },
            {
                title: "On the Plane", emoji: "ğŸ±",
                dialogs: [
                    { role: "AI", text: "Chicken or Beef?", trans: "é›è‚‰é‚„æ˜¯ç‰›è‚‰ï¼Ÿ" },
                    { role: "User", text: "Chicken, please.", trans: "é›è‚‰ï¼Œè¬è¬ã€‚" },
                    { role: "AI", text: "Would you like something to drink?", trans: "éœ€è¦å–é»ä»€éº¼å—ï¼Ÿ" },
                    { role: "User", text: "Can I have some apple juice?", trans: "æˆ‘å¯ä»¥è¦ä¸€äº›è˜‹æœæ±å—ï¼Ÿ" }
                ]
            },
            {
                title: "Immigration", emoji: "ğŸ›‚",
                dialogs: [
                    { role: "AI", text: "What is the purpose of your visit?", trans: "ä½ æ­¤è¡Œçš„ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ" },
                    { role: "User", text: "I am here for tourism.", trans: "æˆ‘æ˜¯ä¾†è§€å…‰çš„ã€‚" },
                    { role: "AI", text: "How long will you stay?", trans: "ä½ æœƒåœç•™å¤šä¹…ï¼Ÿ" },
                    { role: "User", text: "I will stay for five days.", trans: "æˆ‘æœƒå¾…äº”å¤©ã€‚" }
                ]
            },
            {
                title: "Hotel Check-in", emoji: "ğŸ¨",
                dialogs: [
                    { role: "AI", text: "Good evening. How can I help you?", trans: "æ™šå®‰ï¼Œæœ‰ä»€éº¼èƒ½ç‚ºæ‚¨æœå‹™ï¼Ÿ" },
                    { role: "User", text: "Hi, I have a reservation under Chen.", trans: "å—¨ï¼Œæˆ‘æœ‰è¨‚æˆ¿ï¼Œå§“é™³ã€‚" },
                    { role: "AI", text: "Okay. Here is your key card.", trans: "å¥½çš„ã€‚é€™æ˜¯æ‚¨çš„æˆ¿å¡ã€‚" },
                    { role: "User", text: "Does the room have free Wifi?", trans: "æˆ¿é–“æœ‰å…è²»ç„¡ç·šç¶²è·¯å—ï¼Ÿ" }
                ]
            },
            {
                title: "Supermarket", emoji: "ğŸ›’",
                dialogs: [
                    { role: "User", text: "Excuse me, where can I find milk?", trans: "ä¸å¥½æ„æ€ï¼Œè«‹å•ç‰›å¥¶åœ¨å“ªè£¡ï¼Ÿ" },
                    { role: "AI", text: "It's in Aisle 3, next to the yogurt.", trans: "åœ¨ç¬¬3èµ°é“ï¼Œå„ªæ ¼æ—é‚Šã€‚" },
                    { role: "AI", text: "Cash or card?", trans: "ä»˜ç¾é‚„æ˜¯åˆ·å¡ï¼Ÿ" },
                    { role: "User", text: "I will pay by credit card.", trans: "æˆ‘è¦åˆ·å¡ã€‚" }
                ]
            },
            {
                title: "Asking Directions", emoji: "ğŸ—ºï¸",
                dialogs: [
                    { role: "User", text: "Excuse me, how do I get to the station?", trans: "ä¸å¥½æ„æ€ï¼Œè«‹å•è»Šç«™æ€éº¼èµ°ï¼Ÿ" },
                    { role: "AI", text: "Go straight and turn left at the corner.", trans: "ç›´èµ°ï¼Œç„¶å¾Œåœ¨è½‰è§’å·¦è½‰ã€‚" },
                    { role: "User", text: "Is it far from here?", trans: "é›¢é€™è£¡é å—ï¼Ÿ" },
                    { role: "AI", text: "No, it's about a five-minute walk.", trans: "ä¸é ï¼Œèµ°è·¯å¤§ç´„äº”åˆ†é˜ã€‚" }
                ]
            },
            {
                title: "Shopping", emoji: "ğŸ‘•",
                dialogs: [
                    { role: "AI", text: "Can I help you find anything?", trans: "éœ€è¦å¹«å¿™æ‰¾ä»€éº¼å—ï¼Ÿ" },
                    { role: "User", text: "Yes, can I try this on?", trans: "æœ‰çš„ï¼Œæˆ‘å¯ä»¥è©¦ç©¿é€™ä»¶å—ï¼Ÿ" },
                    { role: "AI", text: "Sure, the fitting room is over there.", trans: "ç•¶ç„¶ï¼Œè©¦è¡£é–“åœ¨é‚£é‚Šã€‚" },
                    { role: "User", text: "Do you have this in a larger size?", trans: "é€™ä»¶æœ‰å¤§ä¸€é»çš„å°ºå¯¸å—ï¼Ÿ" }
                ]
            },
            {
                title: "Taking a Taxi", emoji: "ğŸš•",
                dialogs: [
                    { role: "AI", text: "Where to?", trans: "è¦å»å“ªè£¡ï¼Ÿ" },
                    { role: "User", text: "To the Hilton Hotel, please.", trans: "è«‹å»å¸Œçˆ¾é “é£¯åº—ã€‚" },
                    { role: "User", text: "How much is the fare?", trans: "è»Šè³‡å¤šå°‘éŒ¢ï¼Ÿ" },
                    { role: "AI", text: "It's twenty dollars.", trans: "20å…ƒã€‚" },
                    { role: "User", text: "Here you go. Keep the change.", trans: "çµ¦ä½ ã€‚ä¸ç”¨æ‰¾äº†ã€‚" }
                ]
            }
        ];

        // --- ç¨‹å¼é‚è¼¯ ---
        let currentScenario = null;
        let currentLineIndex = 0;
        let recognition;
        let isListening = false;

        // åˆå§‹åŒ–é¦–é 
        window.onload = function() {
            const grid = document.getElementById('scenario-grid');
            scenarios.forEach((s, index) => {
                const btn = document.createElement('button');
                btn.className = 'scenario-btn';
                btn.innerHTML = `<div class="emoji">${s.emoji}</div><div>${s.title}</div>`;
                btn.onclick = () => startScenario(index);
                grid.appendChild(btn);
            });

            // åˆå§‹åŒ–èªéŸ³è¾¨è­˜
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onresult = function(event) {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        transcript += event.results[i][0].transcript;
                    }
                    document.getElementById('result-text').innerText = transcript;
                };

                recognition.onend = function() {
                    isListening = false;
                    document.getElementById('mic-btn').classList.remove('listening');
                };
            } else {
                alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ï¼Œè«‹ä½¿ç”¨ Chrome æˆ– Safariã€‚");
            }
        };

        function startScenario(index) {
            currentScenario = scenarios[index];
            currentLineIndex = 0;
            document.getElementById('menu-page').style.display = 'none';
            document.getElementById('practice-page').style.display = 'flex';
            document.getElementById('scenario-title').innerText = currentScenario.emoji + " " + currentScenario.title;
            loadLine();
        }

        function loadLine() {
            const line = currentScenario.dialogs[currentLineIndex];
            const roleLabel = document.getElementById('role-label');
            const displayText = document.getElementById('display-text');
            const transText = document.getElementById('translation-text');
            const playBtn = document.getElementById('play-btn');
            const micBtn = document.getElementById('mic-btn');
            const resultText = document.getElementById('result-text');

            roleLabel.innerText = line.role;
            displayText.innerText = line.text;
            transText.innerText = line.trans;
            resultText.innerText = "...";

            // æ ¹æ“šè§’è‰²åˆ‡æ› UI
            if (line.role === 'AI') {
                roleLabel.style.color = '#feca57';
                displayText.className = 'text-content ai-text';
                playBtn.style.display = 'flex';
                micBtn.style.display = 'none';
                // è‡ªå‹•æ’­æ”¾å¤ªå¹²æ“¾ï¼Œæ”¹æˆæ‰‹å‹•é»æ“Šæ’­æ”¾
            } else {
                roleLabel.style.color = '#54a0ff';
                displayText.className = 'text-content user-text';
                playBtn.style.display = 'none';
                micBtn.style.display = 'flex';
            }
        }

        function speakText() {
            const text = currentScenario.dialogs[currentLineIndex].text;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9; // ç¨å¾®æ…¢ä¸€é»é»
            window.speechSynthesis.speak(utterance);
        }

        function toggleMic() {
            if (!recognition) return;
            
            if (isListening) {
                recognition.stop();
                isListening = false;
            } else {
                recognition.start();
                isListening = true;
                document.getElementById('mic-btn').classList.add('listening');
                document.getElementById('result-text').innerText = "Listening...";
            }
        }

        function nextLine() {
            currentLineIndex++;
            if (currentLineIndex < currentScenario.dialogs.length) {
                loadLine();
            } else {
                alert("æ­å–œå®Œæˆï¼Great Job! ğŸ‰");
                goHome();
            }
        }

        function goHome() {
            document.getElementById('practice-page').style.display = 'none';
            document.getElementById('menu-page').style.display = 'block';
            window.speechSynthesis.cancel(); // åœæ­¢ç™¼éŸ³
        }
    </script>
</body>
</html>
